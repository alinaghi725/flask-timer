<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Timer with Name</title>
</head>
<body>
    <h1>تایمر با ثبت نام کاربر</h1>

    <label>نام شما:</label>
    <input type="text" id="nameInput" />

    <br /><br />
    <button id="startBtn">شروع تایمر 10 ثانیه‌ای</button>

    <p id="timerDisplay">00:00</p>
    <p id="status"></p>

    <script>
        const startBtn = document.getElementById('startBtn');
        const timerDisplay = document.getElementById('timerDisplay');
        const status = document.getElementById('status');

        let timerDuration = 10; // 10 seconds

        startBtn.addEventListener('click', () => {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) {
                alert('لطفا نام خود را وارد کنید');
                return;
            }

            let timeLeft = timerDuration;
            timerDisplay.textContent = `00:${timeLeft < 10 ? '0' + timeLeft : timeLeft}`;
            status.textContent = '';

            const interval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `00:${timeLeft < 10 ? '0' + timeLeft : timeLeft}`;

                if (timeLeft <= 0) {
                    clearInterval(interval);
                    status.textContent = 'تایمر تمام شد! در حال ذخیره...';

                    fetch('/save_timer', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({name: name, duration: timerDuration})
                    })
                    .then(res => res.json())
                    .then(data => {
                        if(data.status === 'success'){
                            status.textContent = 'ذخیره شد.';
                        } else {
                            status.textContent = 'خطا در ذخیره.';
                        }
                    })
                    .catch(() => {
                        status.textContent = 'خطا در ارتباط با سرور.';
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html>
