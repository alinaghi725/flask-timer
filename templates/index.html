<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8" />
    <title>تایمر شروع و پایان</title>
</head>
<body>
    <h1>تایمر شروع و پایان</h1>
    نام: <input type="text" id="nameInput" />
    <br /><br />
    <button id="startBtn">شروع</button>
    <button id="stopBtn" disabled>توقف</button>
    <p id="status"></p>

    <script>
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        let startTime = null;

        startBtn.onclick = () => {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) {
                alert('لطفا نام خود را وارد کنید');
                return;
            }
            startTime = new Date().toISOString();
            status.textContent = 'تایمر شروع شد: ' + startTime;
            startBtn.disabled = true;
            stopBtn.disabled = false;
        };

        stopBtn.onclick = () => {
            if (!startTime) {
                alert('ابتدا باید تایمر را شروع کنید');
                return;
            }
            const endTime = new Date().toISOString();
            const name = document.getElementById('nameInput').value.trim();

            status.textContent = 'در حال ذخیره...';

            fetch('/save_timer', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: name,
                    start_time: startTime,
                    end_time: endTime
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    status.textContent = 'ذخیره شد';
                } else {
                    status.textContent = 'خطا: ' + data.message;
                }
                startBtn.disabled = false;
                stopBtn.disabled = true;
                startTime = null;
            })
            .catch(() => {
                status.textContent = 'خطا در ارتباط با سرور';
                startBtn.disabled = false;
                stopBtn.disabled = true;
                startTime = null;
            });
        };
    </script>
</body>
</html>
